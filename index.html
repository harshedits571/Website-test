<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software Hub - The Final Clickable Universe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --glow-color-blue: hsl(230, 100%, 60%); --glow-color-red: hsl(0, 100%, 50%); }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #020208;
            color: #e5e7eb;
            overflow: hidden;
            min-height: 100vh;
        }

        #landing-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; z-index: 100; background-color: transparent;
            transition: opacity 1.5s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer;
        }
        #landing-screen.hidden { opacity: 0; pointer-events: none; }
        
        #landing-title {
            position: relative; font-weight: 900;
            animation: fadeInDown 1s ease-out 0.5s both;
            text-shadow: 0 0 15px var(--glow-color-blue), 0 0 30px var(--glow-color-blue); color: #f0f0f5;
        }

        #landing-title::before, #landing-title::after {
            content: attr(data-text); position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; background: #020208;
            overflow: hidden; clip-path: inset(50% 0 50% 0);
        }

        #landing-title::before { left: -2px; text-shadow: 2px 0 var(--glow-color-red); animation: glitch-anim-1 3s infinite linear alternate-reverse; }
        #landing-title::after { left: 2px; text-shadow: -2px 0 var(--glow-color-blue); animation: glitch-anim-2 2.5s infinite linear alternate-reverse; }
        
        @keyframes glitch-anim-1 { 0% { clip-path: inset(46% 0 25% 0); } 25% { clip-path: inset(14% 0 75% 0); } 50% { clip-path: inset(80% 0 10% 0); } 75% { clip-path: inset(30% 0 45% 0); } 100% { clip-path: inset(5% 0 90% 0); } }
        @keyframes glitch-anim-2 { 0% { clip-path: inset(82% 0 12% 0); } 25% { clip-path: inset(22% 0 42% 0); } 50% { clip-path: inset(62% 0 32% 0); } 75% { clip-path: inset(2% 0 88% 0); } 100% { clip-path: inset(92% 0 2% 0); } }

        #landing-subtitle { animation: fadeInUp 1s ease-out 1s both; }

        #enter-orb {
            width: 160px; height: 160px; border-radius: 50%; display: flex;
            justify-content: center; align-items: center; position: relative;
            margin-top: 2.5rem; transition: transform 0.4s ease-in-out, box-shadow 0.4s ease;
            animation: float 4s ease-in-out infinite, fadeInUp 1s ease-out 1.5s both;
            box-shadow: 0 0 20px 0px rgba(79, 70, 229, 0.5), inset 0 0 20px 0px rgba(79, 70, 229, 0.3);
            border: 2px solid rgba(129, 140, 248, 0.5);
            background: radial-gradient(circle, rgba(20, 15, 70, 0.5) 0%, rgba(10, 10, 20, 0.8) 70%); backdrop-filter: blur(5px);
        }
        #enter-orb:hover { transform: scale(1.1); box-shadow: 0 0 35px 5px rgba(79, 70, 229, 0.7), inset 0 0 30px 0px rgba(79, 70, 229, 0.5); }
        #enter-orb::before, #enter-orb::after {
            content: ''; position: absolute; width: 100%; height: 100%; border-radius: 50%;
            border: 2px solid transparent; animation: pulse 3s infinite ease-out;
        }
        #enter-orb::before { border-top-color: rgba(167, 139, 250, 0.8); }
        #enter-orb::after { animation-delay: 1.5s; border-left-color: rgba(99, 102, 241, 0.8); }
        #enter-orb span { font-weight: 600; font-size: 1.2rem; color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.9); animation: textPulse 3s infinite ease-in-out; }
        
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes pulse { 0% { transform: rotate(0deg) scale(1); opacity: 1; } 50% { transform: rotate(180deg) scale(1.4); opacity: 0.5; } 100% { transform: rotate(360deg) scale(1); opacity: 1; } }
        @keyframes textPulse { 0%, 100% { opacity: 0.8; } 50% { opacity: 1; } }

        #galaxy-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; visibility: hidden; transition: opacity 1s ease-out, visibility 1s; }
        #galaxy-container.visible { opacity: 1; visibility: visible; }
        
        #galaxy-canvas { display: block; width: 100%; height: 100%; cursor: grab; }
        #galaxy-canvas:grabbing { cursor: grabbing; }

        .label {
            color: #fff; font-size: 14px; text-shadow: 0 0 5px #000;
            padding: 4px 8px; background: rgba(0,0,0,0.5); border-radius: 4px;
            pointer-events: none; user-select: none; transform: translate(-50%, 0);
        }

        #detail-modal {
            position: fixed; bottom: -100%; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 800px;
            background: rgba(17, 24, 39, 0.8); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem 1.5rem 0 0;
            z-index: 1000; padding: 2rem;
            transition: bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #detail-modal.visible { bottom: 0; }
        .gradient-btn { background-image: linear-gradient(to right, #4f46e5, #7c3aed, #a855f7); background-size: 200% auto; transition: all 0.3s ease; }
        .gradient-btn:hover { background-position: right center; transform: scale(1.05); }

        #galaxy-instructions {
            position: fixed; bottom: 1rem; left: 1rem;
            background: rgba(0,0,0,0.5); padding: 0.5rem 1rem;
            border-radius: 8px; font-size: 0.8rem;
            color: #ccc; z-index: 50;
            animation: fadeInUp 1s ease-out 2s both;
        }
    </style>
</head>
<body>
    <div id="landing-screen">
        <h1 id="landing-title" class="text-6xl md:text-8xl font-black tracking-tighter text-white mb-4" data-text="Software Hub">Software Hub</h1>
        <p id="landing-subtitle" class="text-lg text-gray-400 max-w-xl">A cosmic universe of editing resources. Click the orb to engage.</p>
        <div id="enter-orb" role="button" aria-label="Enter the Software Hub"><span>Engage</span></div>
    </div>

    <div id="galaxy-container">
        <canvas id="galaxy-canvas"></canvas>
        <div id="galaxy-instructions">
            <p>Click & Drag to Orbit | Scroll to Zoom | Click an Icon for Details</p>
        </div>
    </div>

    <div id="detail-modal">
        <button id="close-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
            <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
        <div id="modal-content"></div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        // --- COMPLETE DATABASE - Meticulously copied from new new.html ---
        const DB = {
            software: [
                { id: 'after-effects', name: 'After Effects', desc: 'Motion graphics and visual effects', img: 'https://upload.wikimedia.org/wikipedia/commons/c/cb/Adobe_After_Effects_CC_icon.svg', versions: [{ name: '2025', url: 'https://drive.google.com/file/d/1QF0AHW52ZDpfHqLLIZ4hUSqHHy0Q30ZQ/view?usp=sharing' }, { name: '2024', url: 'https://drive.google.com/file/d/11hAL0WdA77ewKd4iJeGDi1AzViUTtlEM/view?usp=sharing' }, { name: '2023', url: 'https://drive.google.com/file/d/1g_T3o5tcNprBua8jSWqcRe9egwlmCmFU/view?usp=sharing' }, { name: '2022', url: 'https://drive.google.com/file/d/1YRtN-isE8B2c-f2QAW3UniccgLNOSg0n/view?usp=sharing' }, { name: '2021', url: 'https://drive.google.com/file/d/1ZHq06y_CFQtLDTch9GpHt5IwEnWCtGDC/view?usp=sharing' }, { name: '2020', url: 'https://drive.google.com/file/d/1bKed59m-y5ZZI6-4IlEgJBzdGN1C5Rxj/view?usp=sharing' }] },
                { id: 'premiere-pro', name: 'Premiere Pro', desc: 'Professional video editing', img: 'https://upload.wikimedia.org/wikipedia/commons/4/40/Adobe_Premiere_Pro_CC_icon.svg', versions: [{ name: '2025', url: 'https://drive.google.com/file/d/1s2IqZevh2S6oJrVbG3IlZxdUSdfLqT5M/view?usp=sharing' }, { name: '2024', url: 'https://drive.google.com/file/d/1dYcPG8pQHgweVzqbsHWFUeDM51XOhoj-/view?usp=sharing' }, { name: '2023', url: 'https://drive.google.com/file/d/1slPjxo2WmqvJNWMiAi-s70sQABO3AHMN/view?usp=sharing' }, { name: '2022', url: 'https://drive.google.com/file/d/1O3acpw62IVR5oFeMKezpMwjw7rhYv2i-/view?usp=sharing' }, { name: '2021', url: 'https://drive.google.com/file/d/1F_mHHuBdUMcHyWxB03hECKKhCG2sQYYL/view?usp=sharing' }, { name: '2020', url: 'https://drive.google.com/file/d/1xOUNF2XW4YvhmB6qUsW-Yt-_N_kESc5i/view?usp=sharing' }] },
                { id: 'photoshop', name: 'Photoshop', desc: 'Image editing and graphic design', img: 'https://upload.wikimedia.org/wikipedia/commons/a/af/Adobe_Photoshop_CC_icon.svg', versions: [{ name: '2025', url: 'https://drive.google.com/file/d/1klaoh8IR0YvGJlaxqsbattIaG85Ep0Pw/view?usp=drive_link' }, { name: '2024', url: 'https://drive.google.com/file/d/1SEoO-lnrGPP-K7goG75gsZlHiK1wBmf9/view?usp=sharing' }, { name: '2023', url: 'https://drive.google.com/file/d/1kuKfs6dEMMKbTDIq93kIZdYDkB1zFtlh/view?usp=drive_link' }, { name: '2022', url: 'https://drive.google.com/file/d/1kprHBrLUpotVzn1G1spFc0hpoIxFVorM/view?usp=drive_link' }, { name: '2021', url: 'https://drive.google.com/file/d/1kkMbEimMxdIEKVnSR3V_WQLUhyQLA066/view?usp=drive_link' }, { name: '2020', url: 'https://drive.google.com/file/d/1kT8JgYqpvnj30snAiKGjIoXcFgh6nwva/view?usp=sharing' }] },
                { id: 'illustrator', name: 'Illustrator', desc: 'Vector graphics and illustration', img: 'https://upload.wikimedia.org/wikipedia/commons/f/fb/Adobe_Illustrator_CC_icon.svg', versions: [{ name: '2025', url: 'https://drive.google.com/file/d/1ZNajSGAaCaKtcQwESEEKcvA6xTjaXuWm/view?usp=drive_link' }, { name: '2023', url: 'https://drive.google.com/file/d/1l8qS2J0lGnZ0bd5HnW4n3iTrpHfuW3sk/view?usp=drive_link' }, { name: '2022', url: 'https://drive.google.com/file/d/1kx9dU7yV1IpdWlTypA2FZbPjNwKuP7Od/view?usp=drive_link' }, { name: '2021', url: 'https://drive.google.com/file/d/1lAtoWxBQm7SdiZULyAD2YzeoAs00kY8-/view?usp=drive_link' }, { name: '2020', url: 'https://drive.google.com/file/d/1lBrgwAWTQaaCQodJR7rtCpbEumI0wwQb/view?usp=drive_link' }] },
                { id: 'media-encoder', name: 'Media Encoder', desc: 'Rendering and transcoding', img: 'https://www.adobe.com/content/dam/acom/one-console/icons_rebrand/me_appicon.svg', versions: [{ name: '2025', url: 'https://drive.google.com/file/d/1plG-0BWg4zZNYJkyDd2tHakYIXO1vzVx/view?usp=sharing' }, { name: '2024', url: 'https://drive.google.com/file/d/1zHoJ6smv4H_OE2O2P39s1wj7LhIX3OTZ/view?usp=sharing' }, { name: '2023', url: 'https://drive.google.com/file/d/1Az9LBu1pBPaJ5xZoS39wsMfRaNnAz2pZ/view?usp=sharing' }, { name: '2022', url: 'https://drive.google.com/file/d/1rAbr8DRL5W3wFzyRnVohVwByOIw4agxm/view?usp=sharing' }, { name: '2021', url: 'https://drive.google.com/file/d/1Fv3-fK_3vJje6feWKq2dUjZbzE4ofxEV/view?usp=sharing' }, { name: '2020', url: 'https://drive.google.com/file/d/1o53VIZQsswD0de3FusXHlVJ8qwPM7dVZ/view?usp=sharing' }] }
            ],
            plugins: [
                { id: 'sapphire', name: 'Sapphire Suite', desc: 'Industry-standard VFX plugins.', img: 'assets/sap.png', versions: [{ name: 'Sapphire 2024.5', url: '#' }, { name: 'Sapphire 2023.1', url: '#' }] },
                { id: 'bcc', name: 'BCC Suite', desc: 'Comprehensive visual effects.', img: 'assets/cc.png', versions: [{ name: 'Continuum 2022', url: 'https://drive.google.com/file/d/1k287dnhedu9NDOFJy852Why7YxU-2gQO/view?usp=sharing' }] },
                { id: 'magic-bullet', name: 'Magic Bullet Suite', desc: 'Professional color correction tools.', img: 'assets/mb.png', versions: [{ name: 'Magic Bullet 2024', url: 'https://drive.google.com/file/d/1-9qeNipVsdnZ_oR7jQOmevMsArS6iAw1/view?usp=sharing' }] },
                { id: 'shooter-suite', name: 'Shooter Suite', desc: 'Footage prep and delivery tools.', img: 'assets/rg-ss.png', versions: [{ name: 'Shooter Suite 13.1.14', url: 'https://drive.google.com/file/d/1npLp5qHObSe1_PfLMcJF_M3Ta1phMlIc/view?usp=sharing' }] },
                { id: 'vfx-suite', name: 'VFX Suite', desc: 'Keying, tracking, and cleanup.', img: 'assets/vs.png', versions: [{ name: 'VFX Suite 2024', url: 'https://drive.google.com/file/d/1CZm5HASlt1L5pasFOzcN3o_6-b3hq4cz/view?usp=sharing' }] },
                { id: 'element-3d', name: 'Element 3D', desc: 'Advanced 3D render engine.', img: 'assets/e3d.png', versions: [{ name: 'Element 3D v2.2', url: 'https://drive.google.com/file/d/1WzYQHhGlff3P0y9fAl07n1zh2-CRjEjG/view?usp=sharing' }] },
                { id: 'saber', name: 'Saber', desc: 'High-energy beams and effects.', img: 'assets/sab.png', versions: [{ name: 'Saber 1.0.40', url: 'https://drive.google.com/file/d/1cGvMi3f2QOuoQGQnG85x4abfWwvjoUe4/view?usp=sharing' }] },
                { id: 'rsmb', name: 'RSMB', desc: 'ReelSmart Motion Blur.', img: 'assets/rsmb.png', versions: [{ name: 'RSMB Pro', url: 'https://drive.google.com/file/d/1TU1buI7GXPi_i4jzm5FmyEK8nLlgSnXN/view?usp=sharing' }] },
                { id: 'fx-console', name: 'FX Console', desc: 'Workflow utility for effects.', img: 'assets/fxc.png', versions: [{ name: 'FX Console 1.0.5', url: '#' }] },
                { id: 'trapcode-suite', name: 'Trapcode Suite', desc: '3D motion graphics and VFX.', img: 'assets/rg-ts.png', versions: [{ name: 'Trapcode 2023', url: 'https://drive.google.com/file/d/18mMCxWpuVlSREN4smoYtJcn_OVrZGObf/view?usp=sharing' }] },
                { id: 'optical-flares', name: 'Optical Flares', desc: 'Realistic lens flare generator.', img: 'assets/VC-ofpng.png', versions: [{ name: 'Optical Flares v1.3.8', url: 'https://drive.google.com/file/d/1fo9vT2qCfM0fcUioEfTrAD3ZXlCK6m-C/view?usp=sharing' }] },
                { id: 'twixtor-pro', name: 'Twixtor Pro', desc: 'Intelligent slow-motion.', img: 'assets/twxt.png', versions: [{ name: 'Twixtor Pro v7.3.0', url: 'https://drive.google.com/file/d/1pn1h9Mch_xLgFLfgKnh5VYVGa-HqY367/view?usp=drive_link' }] },
                { id: 'red-giant-universe', name: 'Red Giant Universe', desc: 'Effects and transitions library.', img: 'assets/rgu.png', versions: [{ name: 'RG Universe 2024', url: 'https://drive.google.com/file/d/1-EjzbWk-fwnhaGsaBd6LSDdquZI4GVQC/view?usp=sharing' }] },
                { id: 'shadow-studio-3', name: 'Shadow Studio 3', desc: 'Realistic shadow generator.', img: 'assets/ss3.png', versions: [{ name: 'Shadow Studio 3 v1.0.5', url: 'https://drive.google.com/file/d/1QuRTtfrn0Q3wzB0fdN3G2BpAK1LZaDuw/view?usp=drive_link' }] },
                { id: 'deep-glow', name: 'Deep Glow', desc: 'Physically accurate glows.', img: 'assets/dg.jpg', versions: [{ name: 'DeepGlow 1.2', url: 'https://drive.google.com/drive/folders/1RuryQ6dG6b-M2C6hwlwkTEoEKXxcLsOd?usp=sharing' }, { name: 'DeepGlow 2', url: '#' }] },
            ],
            scripts: [
                { id: 'motion-bro', name: 'Motion Bro', desc: 'The most popular extension for presets.', img: 'assets/motion_bro.png', versions: [{ name: 'For Ae 2021 Above', url: 'https://drive.google.com/file/d/1PI17qpqrlwJZrl8Jyj6R6Dl5MzG6_X9C/view?usp=sharing' }] },
                { id: 'flow', name: 'Flow', desc: 'Easy animation curve control.', img: 'assets/flow.png', versions: [{ name: 'v1.5.2', url: 'https://drive.google.com/file/d/134dY8lo2HOJzCe_UJgh16IvDXzcPDih_/view?usp=drive_link' }] },
                { id: 'geolayers', name: 'GEOlayers 3', desc: 'Map animation and data visualization.', img: 'assets/geolayers3.jpg', versions: [{ name: 'GEOlayers 3', url: '#' }] },
                { id: 'jerryflow-v2', name: 'JerryFlow V2', desc: 'The ultimate extension for After Effects', img: 'assets/JerryFlow_v2.png', versions: [{ name: 'JerryFlow V2.0.0', url: 'https://drive.google.com/file/d/1SawuVL0m85aSRbEAtuxiuzJw4MDewfpK/view?usp=sharing' }] },
                { id: 'atomx', name: 'AtomX', desc: 'Extension for motion graphics packages.', img: 'assets/atom_x.jpg', versions: [{ name: 'v3.9.0', url: 'https://drive.google.com/file/d/198oG7orNkjGYuB34uHWKEzFkhwhZTJQl/view?usp=sharing' }] },
                { id: 'keystone', name: 'Keystone', desc: 'Easy layer alignment & distribution.', img: 'assets/keystone.jpg', versions: [{ name: 'v1.1.6', url: 'https://drive.google.com/drive/folders/1Ykjk5fe8Nxi-xBqqFUeM3WvllgDru37A?usp=sharing' }] }
            ],
            utilities: [
                { id: 'topaz-ai', name: 'Topaz AI Suite', desc: 'AI-powered image & video enhancement.', img: 'https://cdn.prod.website-files.com/6005fac27a49a9cd477afb63/634d1e4a5cb8ac88fd07a065_1024.svg', versions: [{ name: 'Version 2.6.0', url: 'https://drive.google.com/file/d/1C-NrR-6ipfKIM06Moyy17EocvuJon6hQ/view?usp=sharing' }] },
                { id: 'filmora-14', name: 'Filmora 14', desc: 'AI-powered efficiency and simplicity.', img: 'https://neveragain.allstatics.com/2019/assets/icon/logo/filmora-square.svg', versions: [{ name: 'v14.0.11.9772', url: 'https://drive.google.com/file/d/1--ITgkydgZQNKz0S0zoEJItEVxrIgsuv/view?usp=drivesdk' }] },
                { id: 'idm', name: 'IDM (Cracked)', desc: 'Internet Download Manager.', img: 'https://cdn6.aptoide.com/imgs/9/c/6/9c688656c4d6227589d5fe3b68e038d2_icon.png?w=128', versions: [{ name: 'Version 20.4', url: '#' }] }
            ]
        };

        let camera, scene, renderer, controls, labelRenderer;
        let galaxyContainer, landingScreen, detailModal, modalContent, closeModalBtn;
        const clock = new THREE.Clock();
        const textureLoader = new THREE.TextureLoader();
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        function init() {
            galaxyContainer = document.getElementById('galaxy-container');
            landingScreen = document.getElementById('landing-screen');
            detailModal = document.getElementById('detail-modal');
            modalContent = document.getElementById('modal-content');
            closeModalBtn = document.getElementById('close-modal');

            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x020208, 0.0005);
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 15000);
            camera.position.set(0, 200, 1200);

            const canvas = document.getElementById('galaxy-canvas');
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);

            labelRenderer = new CSS2DRenderer();
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.domElement.style.position = 'absolute';
            labelRenderer.domElement.style.top = '0px';
            labelRenderer.domElement.style.pointerEvents = 'none';
            galaxyContainer.appendChild(labelRenderer.domElement);
            
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 150;
            controls.maxDistance = 4000;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.05;

            scene.add(new THREE.AmbientLight(0xffffff, 0.8));
            const pointLight = new THREE.PointLight(0xffffff, 1.5, 8000);
            scene.add(pointLight);

            createStarfield();
            createSoftwareGalaxy();
            createPluginGalaxy();

            window.addEventListener('resize', onWindowResize);
            canvas.addEventListener('click', onClick);
            closeModalBtn.addEventListener('click', hideDetailModal);

            animate();
        }

        function createStarfield() {
            const vertices = [];
            for (let i = 0; i < 40000; i++) {
                const x = THREE.MathUtils.randFloatSpread(12000);
                const y = THREE.MathUtils.randFloatSpread(12000);
                const z = THREE.MathUtils.randFloatSpread(12000);
                vertices.push(x, y, z);
            }
            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            const material = new THREE.PointsMaterial({ color: 0xaaaaaa, size: 3, transparent: true, opacity: 0.9 });
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }
        
        const createInteractiveSprite = (itemData, size) => {
            const group = new THREE.Group();
            const map = textureLoader.load(itemData.img, (texture) => {
                texture.colorSpace = THREE.SRGBColorSpace;
            }, undefined, () => {
                const canvas = document.createElement('canvas');
                canvas.width = 128; canvas.height = 128;
                const context = canvas.getContext('2d');
                context.fillStyle = '#4f46e5'; context.fillRect(0,0,128,128);
                context.fillStyle = 'white'; context.font = 'bold 60px Poppins';
                context.textAlign = 'center'; context.textBaseline = 'middle';
                const initials = itemData.name.split(' ').map(n => n[0]).join('').substring(0,2);
                context.fillText(initials, 64, 64);
                const fallbackTexture = new THREE.CanvasTexture(canvas);
                sprite.material.map = fallbackTexture;
                sprite.material.needsUpdate = true;
            });

            const material = new THREE.SpriteMaterial({ map: map, transparent: true, blending: THREE.AdditiveBlending, depthWrite: false, sizeAttenuation: true });
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(size, size, size);
            sprite.userData.itemData = itemData; // Attach data directly to the sprite
            group.add(sprite);

            const labelDiv = document.createElement('div');
            labelDiv.className = 'label';
            labelDiv.textContent = itemData.name;
            const label = new CSS2DObject(labelDiv);
            label.position.set(0, size * 0.7, 0);
            group.add(label);
            
            group.userData.isClickableGroup = true; // Flag for parent group
            return group;
        };
        
        function createGalaxy(items, centerData, systemPosition, itemSize) {
             const galaxyContainer = new THREE.Object3D();
             galaxyContainer.position.copy(systemPosition);
             scene.add(galaxyContainer);

             const sun = createInteractiveSprite(centerData, itemSize * 1.5);
             galaxyContainer.add(sun);

             const baseRadius = 120;
             const radiusIncrement = 70;

             items.forEach((item, i) => {
                const orbitRadius = baseRadius + (i * radiusIncrement);
                
                const orbitContainer = new THREE.Object3D();
                orbitContainer.userData.speed = (0.04 + (0.04 / (i + 1))) * (0.8 + Math.random() * 0.4);
                orbitContainer.rotation.y = Math.random() * Math.PI * 2;
                galaxyContainer.add(orbitContainer);

                const planetGroup = createInteractiveSprite(item, itemSize);
                planetGroup.position.x = orbitRadius;
                orbitContainer.add(planetGroup);
                
                const orbitGeo = new THREE.RingGeometry(orbitRadius - 0.2, orbitRadius + 0.2, 256);
                const orbitMat = new THREE.MeshBasicMaterial({ color: 0x444444, side: THREE.DoubleSide, transparent: true, opacity: 0.3 });
                const orbit = new THREE.Mesh(orbitGeo, orbitMat);
                orbit.rotation.x = -Math.PI / 2;
                orbitContainer.add(orbit);
            });
             return galaxyContainer;
        }

        function createSoftwareGalaxy() {
            const softwareSun = { id: 'creative-cloud', name: 'Adobe', desc: 'The Adobe Software Ecosystem.', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Adobe_Creative_Cloud_fr_2022.svg/320px-Adobe_Creative_Cloud_fr_2022.svg.png' };
            // **FIX**: Increased spacing
            const softwareGalaxy = createGalaxy(DB.software, softwareSun, new THREE.Vector3(-800, 0, 0), 35);
            softwareGalaxy.userData.speed = 0.012;
            scene.add(softwareGalaxy);
        }
        
        function createPluginGalaxy() {
            const allPlugins = [...DB.plugins, ...DB.scripts, ...DB.utilities];
            const pluginSun = { id: 'plugins-core', name: 'Plugins', desc: 'The universe of third-party tools.', img: 'https://placehold.co/128x128/a855f7/ffffff?text=P' };
            // **FIX**: Increased spacing
            const pluginGalaxy = createGalaxy(allPlugins, pluginSun, new THREE.Vector3(800, 0, 0), 22);
            pluginGalaxy.userData.speed = -0.012;
            scene.add(pluginGalaxy);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- DEFINITIVE CLICK FIX ---
        function onClick(event) {
            event.preventDefault();

            // Set mouse coordinates from the canvas element
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            // Get a list of all sprites in the scene
            const spritesToTest = [];
            scene.traverse(object => {
                if (object.isSprite) {
                    spritesToTest.push(object);
                }
            });

            const intersects = raycaster.intersectObjects(spritesToTest);

            if (intersects.length > 0) {
                // The first object in the intersects array is the closest one
                const clickedSprite = intersects[0].object;
                if (clickedSprite.userData.itemData) {
                    showDetailModal(clickedSprite.userData.itemData);
                }
            }
        }
        
        function showDetailModal(data) {
            if (!data || !data.name) return;
            let versionsHTML = '';
            if (data.versions && data.versions.length > 0) {
                versionsHTML = `<div class="mt-4 pt-4 border-t border-white/10">
                    <h4 class="text-xl font-bold text-white mb-3">Available Downloads</h4>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                        ${data.versions.map(v => `<a href="${v.url}" target="_blank" rel="noopener noreferrer" class="text-center gradient-btn text-white font-semibold py-2 px-4 rounded-full text-sm">${v.name}</a>`).join('')}
                    </div>
                </div>`;
            } else {
                 versionsHTML = `<p class="text-gray-400 mt-4">No download links available for this item.</p>`;
            }

            modalContent.innerHTML = `
                <div class="flex flex-col sm:flex-row items-center gap-6">
                     <img src="${data.img}" alt="${data.name}" class="w-32 h-32 rounded-xl object-contain flex-shrink-0 bg-black/20 p-2" onerror="this.src='https://placehold.co/128x128/1e293b/ffffff?text=Error'">
                    <div class="flex-1 text-center sm:text-left">
                        <h3 class="text-3xl font-bold text-white">${data.name}</h3>
                        <p class="text-gray-300 mt-1">${data.desc}</p>
                    </div>
                </div>
                ${versionsHTML}
            `;
            detailModal.classList.add('visible');
            controls.autoRotate = false;
        }

        function hideDetailModal() {
            detailModal.classList.remove('visible');
            controls.autoRotate = true;
        }

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            
            scene.traverse(obj => {
                if (obj.userData.speed) {
                    obj.rotation.y += obj.userData.speed * delta;
                }
            });

            controls.update();
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }

        document.getElementById('enter-orb').addEventListener('click', () => {
            landingScreen.classList.add('hidden');
            setTimeout(() => {
                galaxyContainer.classList.add('visible');
            }, 500);
        });

        init();
    </script>
</body>
</html>

